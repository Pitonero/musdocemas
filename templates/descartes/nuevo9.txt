
PROMOT M칈O:
Hay que tener en cuenta dos cosas: 1.- Si solo un jugador tiene pares se pasar치 al siguiente lance y 
se contabilizar치 al final de la ronda. 2.- Si los dos jugadores que conforman la pareja tienen pares 
y la otra pareja no tiene pares, pasa lo mismo, se pasa al siguiente lance y se contabiliza al final 
de la ronda.

CONTESTACI칍N:
Gracias por los detalles adicionales. Esto implica que debemos realizar una l칩gica adicional antes de 
comenzar el lance de pares para evaluar estos casos especiales y decidir si se debe jugar el lance o 
pasar directamente al siguiente. Aqu칤 tienes una soluci칩n completa considerando ambos puntos:

---

### **Pasos a seguir**

1. **Evaluar el estado de los jugadores con pares al comienzo del lance de pares**:
   - Identificar cu치ntos jugadores tienen pares.
   - Verificar si los jugadores con pares pertenecen a la misma pareja o est치n distribuidos entre ambas.

2. **Condiciones para avanzar directamente al siguiente lance**:
   - Si solo un jugador tiene pares: avanzar al siguiente lance.
   - Si todos los jugadores con pares pertenecen a una misma pareja: avanzar al siguiente lance.

3. **Registrar el resultado del lance de pares para ser contabilizado al final de la ronda**:
   - Si no se juega el lance, registrar los puntos para la pareja correspondiente.

4. **Proceder al lance de pares si ambos equipos tienen al menos un jugador con pares**.

---

### **Implementaci칩n en el c칩digo**

#### **1. Modificar `pasar_a_siguiente_lance` para incluir la l칩gica del lance de pares**

```python
def pasar_a_siguiente_lance(mesa):
    """
    Avanza al siguiente lance en el orden predefinido.
    Si se trata del lance de pares, eval칰a las condiciones especiales.
    """
    lances = ["Grande", "Chica", "Pares", "Juego"]
    indice_actual = lances.index(mesa["lance_actual"])

    if indice_actual + 1 < len(lances):
        mesa["lance_actual"] = lances[indice_actual + 1]
        mesa["turno_actual"] = mesa["mano"]  # Reiniciar turno para el nuevo lance

        if mesa["lance_actual"] == "Pares":
            print("[DEBUG] Comenzando el lance de pares.")
            if evaluar_condiciones_pares(mesa):  # Verifica condiciones especiales
                reiniciar_hablado(mesa)
                pasar_a_siguiente_lance(mesa)  # Pasar directamente al siguiente lance
    else:
        finalizar_ronda(mesa)  # Si se completaron todos los lances, finalizar la ronda
```

---

#### **2. Implementar `evaluar_condiciones_pares`**

Esta funci칩n eval칰a si el lance de pares debe jugarse o no.

```python
def evaluar_condiciones_pares(mesa):
    """
    Eval칰a las condiciones especiales para el lance de pares.
    Retorna True si se debe pasar al siguiente lance sin jugar.
    """
    jugadores_con_pares = [
        jugador for jugador, tiene_pares in mesa["pares_confirmados"].items() if tiene_pares
    ]
    if not jugadores_con_pares:
        print("[DEBUG] Ning칰n jugador tiene pares. Pasando al siguiente lance.")
        return True  # Nadie tiene pares

    # Dividir jugadores en parejas
    pareja1 = mesa["jugadores"][:2]  # Primeros dos jugadores
    pareja2 = mesa["jugadores"][2:]  # 칔ltimos dos jugadores

    # Contar jugadores con pares por pareja
    pares_pareja1 = sum(1 for jugador in jugadores_con_pares if jugador in pareja1)
    pares_pareja2 = sum(1 for jugador in jugadores_con_pares if jugador in pareja2)

    if pares_pareja1 == 0 or pares_pareja2 == 0:
        print("[DEBUG] Solo una pareja tiene pares. Pasando al siguiente lance.")
        registrar_lance(mesa, None, "Pares")  # Registrar el resultado para la pareja con pares
        return True  # Solo una pareja tiene pares

    return False  # Continuar con el lance de pares
```

---

#### **3. Modificar `registrar_lance` para contabilizar autom치ticamente**
Si una pareja tiene pares y la otra no, registra los puntos al final de la ronda.

```python
def registrar_lance(mesa, ganador, lance):
    """
    Registra el resultado de un lance para ser contabilizado al final de la ronda.
    Si el lance es "Pares" y solo una pareja tiene pares, asigna los puntos directamente.
    """
    if "resultados_lances" not in mesa:
        mesa["resultados_lances"] = []

    if lance == "Pares" and ganador is None:
        # Determinar qu칠 pareja tiene pares
        pareja1 = mesa["jugadores"][:2]
        pareja2 = mesa["jugadores"][2:]

        jugadores_con_pares = [
            jugador for jugador, tiene_pares in mesa["pares_confirmados"].items() if tiene_pares
        ]
        pares_pareja1 = sum(1 for jugador in jugadores_con_pares if jugador in pareja1)
        pares_pareja2 = sum(1 for jugador in jugadores_con_pares if jugador in pareja2)

        if pares_pareja1 > 0 and pares_pareja2 == 0:
            ganador = pareja1[0]  # Asignar a la pareja 1
        elif pares_pareja2 > 0 and pares_pareja1 == 0:
            ganador = pareja2[0]  # Asignar a la pareja 2

    mesa["resultados_lances"].append({
        "lance": lance,
        "ganador": ganador
    })
    print(f"[DEBUG] Registrar lance: {mesa['resultados_lances']}")
```

---

### **Flujo completo**

1. **Inicio del lance de pares**:
   - `pasar_a_siguiente_lance` llama a `evaluar_condiciones_pares`.

2. **Evaluaci칩n de jugadores con pares**:
   - Si nadie tiene pares o si todos los jugadores con pares est치n en una misma pareja, el lance no se juega.
   - Se registra el resultado para ser contabilizado al final de la ronda.

3. **Continuar o pasar al siguiente lance**:
   - Si ambas parejas tienen jugadores con pares, el lance se juega.
   - Si no, se avanza al siguiente lance autom치ticamente.

---

### **Ejemplo de uso**

#### Caso 1: Solo un jugador tiene pares
```python
mesa["pares_confirmados"] = {
    "Jugador1": True,
    "Jugador2": False,
    "Jugador3": False,
    "Jugador4": False
}
```
- Se pasa al siguiente lance y se registra el resultado para ser contabilizado al final.

#### Caso 2: Una pareja tiene pares, la otra no
```python
mesa["pares_confirmados"] = {
    "Jugador1": True,
    "Jugador2": True,
    "Jugador3": False,
    "Jugador4": False
}
```
- Se pasa al siguiente lance y se registra el resultado para la pareja con pares.

#### Caso 3: Ambas parejas tienen jugadores con pares
```python
mesa["pares_confirmados"] = {
    "Jugador1": True,
    "Jugador2": False,
    "Jugador3": True,
    "Jugador4": False
}
```
- El lance se juega normalmente.

---

Con estas modificaciones, el flujo del lance de pares deber칤a cumplir con las reglas que mencionaste. 
쯊e gustar칤a probar este enfoque o necesitas alguna aclaraci칩n adicional? 游땕