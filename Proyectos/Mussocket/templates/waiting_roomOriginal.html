<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sala de Espera</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
		const socket = io.connect();

		// Actualiza la lista de jugadores
		socket.on('update_players', function(players) {
			alert('Entra en update players');
			const playerList = document.getElementById('player-list');
			playerList.innerHTML = '';
			players.forEach(player => {
				const li = document.createElement('li');
				li.innerText = player;
				playerList.appendChild(li);
				alert("Jugador ", player);
			});
		});

		// Actualiza la lista de mesas
		socket.on('update_tables', function(tables) {
			const tableList = document.getElementById('table-list');
			tableList.innerHTML = '';
			tables.forEach(table => {
				const li = document.createElement('li');
				li.innerText = table;
				li.onclick = () => joinTable(table);
				tableList.appendChild(li);
				alert("Mesas ", table);
			});
		});

		// Recibe y muestra un mensaje de chat
		socket.on('chat_message', function(data) {
			alert('Entra en enviar mensaje de chat');
			const chatBox = document.getElementById('chat-box');
			const message = document.createElement('p');
			message.innerText = `${data.username}: ${data.message}`;
			chatBox.appendChild(message);
		});

		// Enviar mensaje de chat
		function sendMessage() {
			alert('message');
			const message = document.getElementById('chat-message').value;
			socket.emit('chat_message', { username: "{{ username }}", message });
			document.getElementById('chat-message').value = '';
		}

		// Crear una mesa
		function createTable() {
			const tableName = document.getElementById('table-name').value;
			socket.emit('create_table', { table_name: tableName });
			document.getElementById('table-name').value = '';
		}

		// Unirse a una mesa
		function joinTable(tableName) {
			socket.emit('join_table', { table_name: tableName });
		}
	</script>
</head>
<body>
    <h2>Bienvenido, {{ username }} a la Sala de Espera</h2>
    <div id="username" data-username="{{ username }}"></div> <!-- Elemento oculto con el username -->
    <div class="chat">
        <div id="chat-box"></div>
        <input id="chat-message" placeholder="Escribe un mensaje..." />
        <button onclick="sendMessage()">Enviar</button>
    </div>

    <div class="table-management">
        <h3>Mesas Disponibles</h3>
        <ul id="table-list"></ul>
        <input id="table-name" placeholder="Nombre de la mesa" />
        <button onclick="createTable()">Crear Mesa</button>
    </div>

    <div>
        <h3>Jugadores en la Sala</h3>
        <ul id="player-list"></ul>
    </div>
	<script>
      document.addEventListener('DOMContentLoaded', () => { 
		const socket = io.connect();
        const username = document.getElementById("username").dataset.username;

        // Enviar el evento de conexi√≥n al servidor con el nombre de usuario
        socket.emit('join', { username: username });

        socket.on('update_players', function(players) {
            // Actualiza la lista de jugadores conectados
		function sendMessage() {
           const message = "Este es un mensaje de prueba";
           socket.emit('chat_message', { username: username, message: message });
         }
        });
    </script>
</body>
</html>

