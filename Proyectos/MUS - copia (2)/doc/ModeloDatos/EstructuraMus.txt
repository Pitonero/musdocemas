-- CREATE DATABASE IF NOT EXISTS mus_game;
USE mus_game;
ALTER TABLE usuarios DROP INDEX nombre_usuario
ALTER TABLE usuarios
ADD COLUMN codigo_activacion VARCHAR(6),
ADD COLUMN verificado BOOLEAN DEFAULT FALSE;

-- Tabla de usuarios, para almacenar la información básica del usuario
drop table Usuarios;
CREATE TABLE Usuarios (
    usuario_id INT PRIMARY KEY AUTO_INCREMENT,
    nombre_usuario VARCHAR(50) NOT NULL,
    alias VARCHAR(50) UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(100),
    activo VARCHAR(1)
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE Usuarios (
    usuario_id INT PRIMARY KEY AUTO_INCREMENT,
    nombre_usuario VARCHAR(50) NOT NULL UNIQUE,
    alias VARCHAR(50) UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(100),
    fecha_registro DATE DEFAULT CURRENT_DATE
);

-- Tabla de mesas, donde se crean las mesas de juego
CREATE TABLE Mesas (
    mesa_id INT PRIMARY KEY AUTO_INCREMENT,
    nombre_mesa VARCHAR(100) NOT NULL,
    juego_id INT NOT NULL, -- Indica a qué juego pertenece la mesa
    creador_id INT NOT NULL, -- Usuario que creó la mesa
    es_privada BOOLEAN DEFAULT FALSE,
    password_hash VARCHAR(255),
    estado VARCHAR(20), --ENUM('esperando', 'en juego', 'completada') DEFAULT 'esperando',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ParticipantesMesa (
    mesa_id INT NOT NULL PRIMARY KEY,
    participante_id INT,
    mesa_id INT NOT NULL,
    usuario_id INT NOT NULL,
    posicion INT NOT NULL, -- La posición en la mesa (1 a 4, por ejemplo)
    avatar_url VARCHAR(255), -- Avatar usado en la mesa
    UNIQUE (mesa_id, posicion) -- Cada posición en la mesa debe ser única
);

-- Tabla de partidas, para guardar el detalle de cada partida en una mesa específica
CREATE TABLE Partidas (
    partida_id INT PRIMARY KEY AUTO_INCREMENT,
    mesa_id INT NOT NULL,
    estado VARCHAR(20) --ENUM('activa', 'finalizada') DEFAULT 'activa',
    fecha_inicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_fin TIMESTAMP,
    ganador_equipo  VARCHAR(20) --ENUM('equipo_1', 'equipo_2', 'empate') DEFAULT NULL,
    puntuacion_equipo_1 INT DEFAULT 0,
    puntuacion_equipo_2 INT DEFAULT 0,
    turno_actual INT -- ID del jugador que tiene el turno actual
);

-- Tabla de estadísticas, que acumula puntos, victorias, y otros datos de juego de cada usuario
CREATE TABLE Estadisticas (
    estadistica_id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,
    partidas_jugadas INT DEFAULT 0,
    partidas_ganadas INT DEFAULT 0,
    puntuacion_acumulada INT DEFAULT 0,
    tiempo_juego_acumulado TIME DEFAULT '00:00:00',
    envites_totales INT DEFAULT 0,
    señas_totales INT DEFAULT 0
);

-- Tabla de jugadores en partida, para registrar a los jugadores y su rol en una partida
CREATE TABLE JugadoresPartida (
    jugador_partida_id INT PRIMARY KEY AUTO_INCREMENT,
    partida_id INT NOT NULL,
    usuario_id INT NOT NULL,
    equipo ,
    puntos INT DEFAULT 0
);

-- Tabla de mensajes del chat, para manejar los mensajes enviados durante una partida
CREATE TABLE MensajesChat (
    mensaje_id INT PRIMARY KEY AUTO_INCREMENT,
    partida_id INT NOT NULL,
    usuario_id INT NOT NULL,
    contenido TEXT NOT NULL,
    fecha_envio TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de apuestas, para manejar los envites realizados por cada jugador en cada ronda
CREATE TABLE Apuestas (
    apuesta_id INT PRIMARY KEY AUTO_INCREMENT,
    partida_id INT NOT NULL,
    usuario_id INT NOT NULL,
    tipo_apuesta VARCHAR(20), -- ENUM('grande', 'chica', 'pares', 'juego'),
    cantidad INT NOT NULL,
    fecha_apuesta TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de señas, para registrar los gestos o señas enviadas por los jugadores
CREATE TABLE Señas (
    seña_id INT PRIMARY KEY AUTO_INCREMENT,
    partida_id INT NOT NULL,
    usuario_id INT NOT NULL,
    tipo_seña VARCHAR(20),  --ENUM('guiñar', 'lengua', 'cejas', 'labios'),
    fecha_seña TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de rondas (opcional) para llevar el registro detallado de cada ronda en una partida
CREATE TABLE Rondas (
    ronda_id INT PRIMARY KEY AUTO_INCREMENT,
    partida_id INT NOT NULL,
    numero_ronda INT NOT NULL,
    estado VARCHAR(20) -- ENUM('activa', 'completada') DEFAULT 'activa'
);

CREATE TABLE Rankings (
    ranking_id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,
    juego_id INT NOT NULL,
    puntos INT DEFAULT 0,
    FOREIGN KEY (usuario_id) REFERENCES Usuarios(usuario_id),
    FOREIGN KEY (juego_id) REFERENCES Juegos(juego_id),
    UNIQUE (usuario_id, juego_id) -- Un usuario no puede tener más de un ranking por juego
);

CREATE TABLE Juegos (
    juego_id INT PRIMARY KEY AUTO_INCREMENT,
    nombre_juego VARCHAR(100) NOT NULL UNIQUE,
    descripcion TEXT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);