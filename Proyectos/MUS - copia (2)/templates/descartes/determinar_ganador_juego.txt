def determinar_ganador_juego(mesa):
    """
    Determina el ganador del lance Juego y actualiza los puntos.
    Evalúa las puntuaciones de los jugadores según las reglas:
    - 31 es la puntuación más alta: +3 puntos.
    - Puntuaciones válidas mayores que 31 (40, 32, ...): +2 puntos.
    En caso de empate, gana el jugador que es mano.
    """
    print("[DEBUG] Entra en determinar ganador de juego.")

    manos = mesa["manos"]
    jugadores = mesa["jugadores"]

    # Mapa de valores de las cartas para el lance Juego
    mapa_valores = {
        "1": 1, "2": 1, "3": 10, "4": 4, "5": 5, "6": 6, "7": 7,
        "10": 10, "11": 10, "12": 10  # Sota, Caballo, Rey
    }

    # Orden de puntuaciones para el juego
    orden_puntuaciones = [31, 40, 32, 39, 38, 37, 36, 35, 34, 33]

    # Configuración de las parejas
    parejas = {
        jugadores[0]: 0,  # Pareja 1
        jugadores[2]: 0,  # Pareja 1
        jugadores[1]: 1,  # Pareja 2
        jugadores[3]: 1   # Pareja 2
    }

    # Calcular puntos de cada jugador
    puntos_jugadores = {
        jugador: sum(mapa_valores[carta[:-1]] for carta in mano)
        for jugador, mano in manos.items()
    }

    print(f"[DEBUG] Puntos de los jugadores en Juego: {puntos_jugadores}")

    # Filtrar solo jugadores con juego
    jugadores_con_juego = [
        jugador for jugador in jugadores
        if puntos_jugadores[jugador] in orden_puntuaciones
    ]

    if not jugadores_con_juego:
        # Si nadie tiene juego, no se asignan puntos
        print("[DEBUG] Ningún jugador tiene juego. No se asignan puntos.")
        return None

    # Resolver ganador
    mano_index = mesa["mano"]  # Índice del jugador que es mano
    jugadores_ordenados = jugadores[mano_index:] + jugadores[:mano_index]  # Orden desde el mano

    # Resolver ganador según las reglas
    ganador = max(
        jugadores_con_juego,
        key=lambda j: (
            orden_puntuaciones.index(puntos_jugadores[j]),
            -jugadores_ordenados.index(j)  # Prioridad al mano en caso de empate
        )
    )

    # **CORRECCIÓN**: Verificar desempate por "mano"
    # Si hay varios jugadores con la misma puntuación, gana el primero en `jugadores_ordenados`
    puntuacion_maxima = puntos_jugadores[ganador]
    empatados = [
        jugador for jugador in jugadores_con_juego
        if puntos_jugadores[jugador] == puntuacion_maxima
    ]
    if len(empatados) > 1:
        ganador = min(empatados, key=lambda j: jugadores_ordenados.index(j))

    print(f"[DEBUG] Ganador provisional del Juego: {ganador} con {puntos_jugadores[ganador]} puntos.")

    # Calcular puntos adicionales como antes
    equipo = parejas[ganador]
    compañero = [j for j in jugadores if parejas[j] == equipo and j != ganador][0]

    # Revisar puntos del ganador
    puntos_ganador = puntos_jugadores[ganador]
    puntos_ganados = 0
    if puntos_ganador == 31:
        puntos_ganados += 3
    elif puntos_ganador > 31:
        puntos_ganados += 2

    # Sumar puntos del compañero si tiene juego válido
    if puntos_jugadores[compañero] in orden_puntuaciones:
        if puntos_jugadores[compañero] == 31:
            puntos_ganados += 3
        elif puntos_jugadores[compañero] > 31:
            puntos_ganados += 2

    print(f"[DEBUG] Juego: Puntos totales ganados por el equipo {equipo}: {puntos_ganados}.")

    # Agregar puntos a la mesa
    mesa["puntos"][equipo] += puntos_ganados
    mesa["juego"][equipo] += puntos_ganados

    print(f"[DEBUG] Ganador del lance Juego: {ganador} con {puntos_ganador} puntos")
    print(f"[DEBUG] Puntos acumulados en la mesa: {mesa['puntos']}")

    return ganador